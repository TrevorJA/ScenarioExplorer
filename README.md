# Scenario Explorer
ScenarioExplorer is an open-source Python package to aid in scenario discovery.

```toc
```


## Features

`ScenarioExplorer(*args, **kwargs)`

> \*\*kwargs
> 	`fail_threshold` : (float) Numeric performance metric threshold, separating *success* and *failure* conditions.
> 	`fail_criteria`: (str) Options include "<", "<=", ">", ">="
> 	`method`: (str) Classification algorithm to use. Currently supported options are "logistic" and "boosted-trees"



## Classification algorithms

### Gradient Boosted Trees

The [gradient boosted tree](https://en.wikipedia.org/wiki/Gradient_boosting#Gradient_tree_boosting) algorithm uses [classsification (AKA decision) trees](https://en.wikipedia.org/wiki/Decision_tree_learning) to iteratively sub-divide the parameter space, so that divided regions best describe the division of *success* or *failure* occurrences.

```python
import ScenarioExplorer

# XY = training data

## Boosted trees (nonlinear boundary)
SE = ScenarioExplorer.ScenarioExplorer(XY,
                                       fail_threshold = 0.5,
                                       fail_criteria = '<=',
                                       method = 'boosted-trees')
```

### Logistic Regression

[Logistic regression](https://en.wikipedia.org/wiki/Logistic_regression) models estimate the ***probability*** that an event is classified as a success (1) as opposed to a failure (0) as a function of different covariates.

It may also identify which factors influence ability to meet those performance goals.

```python
import ScenarioExplorer

# XY = training data

## Logistic regression (linear)
SE = ScenarioExplorer.ScenarioExplorer(XY,
                                       fail_threshold = 0.5,
                                       fail_criteria = '<=',
                                       method = 'logistic')
```


#### Mathematical definition

For $p_i$ representing the probability that performance in the $i^{th}$ SOW is classified as a success and $X_i$ represents a vector of covariates describing the $i^{th}$ SOW:
$$\tag{1.0} ln\Big(\frac{p_i}{1-p_i}\Big) = X_i^T\beta$$

The coefficients on the covariates, $\beta$, are estimated using [[Maximum Likelihood Estimation]].



## Data Visualization

`ScenarioExplorer` includes plotting functions to help with data visualization.

Currently, it supports:
- 2D parameter satisficing contour plots
- *More to come...*

The `ScenarioExplorer.plot_contour(vars)` will train the classification model, and use to model to predict classifications across a two-dimensional grid of parameter values, and plot a map of the classification regions. `vars` is a list of two input parameter names.
```python
plot_variables = ['x1', 'x2']
SE.plot_contour(plot_variables,
                save_figure = False)
```



## References

(1) [*Scenario discovery in Python.* Jan Kwakkel. (2015)](https://waterprogramming.wordpress.com/2015/08/05/scenario-discovery-in-python/)
(2) [*A step by step tutorial for scenario discovery with gradient boosted trees*. David Gold. (2022)](https://waterprogramming.wordpress.com/2022/04/22/a-step-by-step-tutorial-for-scenario-discovery-with-gradient-boosted-trees/)
(3) [*Logistic regression for Scenario Discovery*. Julie Quinn. (2018)](https://waterprogramming.wordpress.com/2018/05/04/logistic-regression-for-scenario-discovery/)


*******
# Quick Start Demo

## Installation

Make sure that you have all of the necessary Python packages by installing all packages listed in the `requirements.txt`.  From a Windows command line, you can do this using `pip` by executing:
```
python -m pip install -r requirements.txt
```
If you do not use Windows, want to operate through a virtual environment, or are using `conda` for package management, use suitable methods for installing dependences in `requirements.txt` in your environment.

## Usage

All of the following demo script is included in the `package_demo.py` file.

Here, I show how to use both the linear regression and boosted tree classifiers to visualize regions of success based upon a performance metrics.

Begin by importing `ScenarioExplorer`:
```python
import ScenarioExplorer
```
For the purposes of this demo, I create some fake (but intentionally non-linear) data according to the following definition:
$$\text{Performance} = y = 3 x_1 x_2^2$$
Where $x_1$ and $x_2$ are random variables. This sudo-data is generated by the following code block:
```python
### Create demo data
# Number of samples
N = 1000

# Random variable values
XY = pd.DataFrame({'x1': np.random.rand(N),
                   'x2': np.random.rand(N),
                   'x3': np.random.rand(N),
                   'x4': np.random.rand(N),
                   'x5': np.random.rand(N)})

# Output metric y is a function of others
XY['performance'] = XY['x1'] * 3*XY['x2']**2
```

>![Warning] Input data formatting
>The input data (`XY`) must be a Pandas DataFrame, with the performance criteria column named `"performance"`. Input column names can be unique, but must be consistent between training and prediction, i.e.,  `ScenarioExplorer.train()` and `ScenarioExplorer.predict(New_XY)`.

### Logistic regression
To use the `LogisticRegressionClassifer` algorithm, you need to specify the `method = 'logistic'` argument when initializing the `ScenarioExplorer` object.
```python
## Logistic regression (linear)
SE = ScenarioExplorer.ScenarioExplorer(XY,
                                       fail_threshold = 0.5,
                                       fail_criteria = '<=',
                                       method = 'logistic')

# Choose variables of interest
plot_variables = ['x1', 'x2']

SE.plot_contour(plot_variables,
                save_figure = False)
```

![[figures/ScenarioExplorer.png | 600]]


### Boosted trees

To use the `BoostedTreeClassifer` algorithm, you need to specify the `method = 'boosted-tress'` argument when initializing the `ScenarioExplorer` object. The following code block initializes a in instance of `ScenarioExplorer` (`SE`) with the `boosted-tree` method:
```python
## Boosted trees (nonlinear boundary)
SE = ScenarioExplorer.ScenarioExplorer(XY,
                                       fail_threshold = 0.5,
                                       fail_criteria = '<=',
                                       method = 'boosted-trees')

# Choose variables of interest
plot_variables = ['x1', 'x2']

SE.plot_contour(plot_variables,
                save_figure = False)
```

![[/figures/ScenarioExplorer-1.png | 600]]
Notice that the boosted tree algorithm does a better job describing the nonlinearity of the success-boundary compared to the logistic regression.  However, we are not able to estimate the *probability* of success using boosted trees, which is a strength of the logistic model.
